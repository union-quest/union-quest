{"version":3,"file":"notifications-998beaef.js","sources":["../../../../../src/lib/utils/web.ts","../../../../../src/lib/utils/eth/networks.ts","../../../../../src/lib/config.ts","../../../../../src/lib/web/notifications.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\nexport function getParamsFromURL(url: string): {params: Record<string, string>; pathname?: string} {\n  if (!url) {\n    return {params: {}, pathname: ''};\n  }\n  const obj: Record<string, string> = {};\n  const hash = url.lastIndexOf('#');\n\n  let cleanedUrl = url;\n  if (hash !== -1) {\n    cleanedUrl = cleanedUrl.slice(0, hash);\n  }\n\n  const question = cleanedUrl.indexOf('?');\n  if (question !== -1) {\n    cleanedUrl\n      .slice(question + 1)\n      .split('&')\n      .forEach((piece) => {\n        const [key, val = ''] = piece.split('=');\n        obj[decodeURIComponent(key)] = val === '' ? 'true' : decodeURIComponent(val);\n      });\n  }\n\n  let pathname = cleanedUrl.slice(0, question) || '';\n  if (pathname && !pathname.endsWith('/')) {\n    pathname += '/';\n  }\n  return {params: obj, pathname};\n}\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\nexport function getParamsFromLocation(): {params: Record<string, string>; pathname?: string} {\n  if (typeof window === 'undefined') {\n    return {params: {}};\n  }\n  return getParamsFromURL(window.location.href);\n}\n\nexport function getHashParamsFromLocation(str?: string): Record<string, string> {\n  if (typeof window === 'undefined') {\n    return {};\n  }\n  const url = str || window.location.hash;\n  const obj: Record<string, string> = {};\n  const hash = url.lastIndexOf('#');\n\n  if (hash !== -1) {\n    url\n      .slice(hash + 1)\n      .split('&')\n      .forEach((piece) => {\n        const [key, val = ''] = piece.split('=');\n        obj[decodeURIComponent(key)] = decodeURIComponent(val);\n      });\n  }\n  return obj;\n}\n\nexport function queryStringifyNoArray(query: Record<string, string>): string {\n  let str = '';\n  for (const key of Object.keys(query)) {\n    const value = query[key];\n    str += `${str === '' ? '?' : '&'}${key}=${value}`;\n  }\n  return str;\n}\n\nexport function rebuildLocationHash(hashParams: Record<string, string>): void {\n  if (typeof window === 'undefined') {\n    return;\n  }\n  let reconstructedHash = '';\n  Object.entries(hashParams).forEach((param) => {\n    if (reconstructedHash === '') {\n      reconstructedHash += '#';\n    } else {\n      reconstructedHash += '&';\n    }\n    reconstructedHash += param.join('=');\n  });\n\n  if ('replaceState' in window.history) {\n    window.history.replaceState(\n      '',\n      document.title,\n      window.location.pathname + window.location.search + reconstructedHash\n    );\n  } else {\n    // Prevent scrolling by storing the page's current scroll offset\n    const {scrollTop, scrollLeft} = document.body;\n    window.location.hash = '';\n\n    // Restore the scroll offset, should be flicker free\n    document.body.scrollTop = scrollTop;\n    document.body.scrollLeft = scrollLeft;\n  }\n}\n\nasync function chrome76Detection(): Promise<boolean> {\n  if ('storage' in navigator && 'estimate' in navigator.storage) {\n    const {quota} = await navigator.storage.estimate();\n    return quota !== undefined && quota < 120000000;\n  }\n  return false;\n}\n\nfunction isNewChrome(): boolean {\n  const pieces = navigator.userAgent.match(/Chrom(?:e|ium)\\/([0-9]+)\\.([0-9]+)\\.([0-9]+)\\.([0-9]+)/);\n  if (pieces === null || pieces.length !== 5) {\n    return false;\n  }\n  const major = pieces.map((piece) => parseInt(piece, 10))[1];\n  return major >= 76;\n}\n\nexport function isPrivateWindow(): Promise<boolean | null> {\n  return new Promise((resolve) => {\n    try {\n      const isSafari =\n        navigator.vendor &&\n        navigator.vendor.indexOf('Apple') > -1 &&\n        navigator.userAgent &&\n        navigator.userAgent.indexOf('CriOS') === -1 &&\n        navigator.userAgent.indexOf('FxiOS') === -1;\n\n      if (isSafari) {\n        // Safari\n        let e = false;\n        if ((window as any).safariIncognito) {\n          e = true;\n        } else {\n          try {\n            (window as any).openDatabase(null, null, null, null);\n            window.localStorage.setItem('test', '1');\n            resolve(false);\n          } catch (err) {\n            e = true;\n            resolve(true);\n          }\n          // eslint-disable-next-line no-unused-expressions, no-void\n          void !e && ((e = !1), window.localStorage.removeItem('test'));\n        }\n      } else if (navigator.userAgent.includes('Firefox')) {\n        // Firefox\n        const db = indexedDB.open('test');\n        db.onerror = () => {\n          resolve(true);\n        };\n        db.onsuccess = () => {\n          resolve(false);\n        };\n      } else if (\n        navigator.userAgent.includes('Edge') ||\n        navigator.userAgent.includes('Trident') ||\n        navigator.userAgent.includes('msie')\n      ) {\n        // Edge or IE\n        if (!window.indexedDB && (window.PointerEvent || window.MSPointerEvent)) {\n          resolve(true);\n        }\n        resolve(false);\n      } else {\n        // Normally ORP or Chrome\n        if (isNewChrome()) {\n          resolve(chrome76Detection());\n        }\n\n        const fs = (window as any).RequestFileSystem || (window as any).webkitRequestFileSystem;\n        if (!fs) {\n          resolve(null);\n        } else {\n          fs(\n            (window as any).TEMPORARY,\n            100,\n            () => resolve(false),\n            () => resolve(true)\n          );\n        }\n      }\n    } catch (err) {\n      // eslint-disable-next-line no-console\n      console.error(err);\n      resolve(null);\n    }\n  });\n}\n","export const chainNames: {[chainId: string]: string} = {\n  '1': 'mainnet',\n  '3': 'ropsten',\n  '4': 'rinkeby',\n  '5': 'goerli',\n  '42': 'kovan',\n  '1337': 'localhost chain',\n  '31337': 'localhost chain',\n};\n\nexport function nameForChainId(chainId: string): string {\n  const name = chainNames[chainId];\n  if (name) {\n    return name;\n  }\n  return `chain with id ${chainId}`;\n}\n","import {getDefaultProvider, Provider} from '@ethersproject/providers';\nimport {nameForChainId} from './utils/eth/networks';\nimport {getParamsFromLocation, getHashParamsFromLocation} from './utils/web';\n\nimport * as Sentry from '@sentry/browser';\nimport {Integrations} from '@sentry/tracing';\nimport {RewriteFrames as RewriteFramesIntegration} from '@sentry/integrations';\n\nlet root = undefined;\nif (typeof window !== 'undefined') {\n  root = window.location.protocol + '//' + window.location.host + (window as any).BASE;\n}\nconsole.log(`VERSION: ${__VERSION__}`);\n\nexport const hashParams = getHashParamsFromLocation();\nexport const {params} = getParamsFromLocation();\n// export const VERSION = '1';\n\nconst chainId = import.meta.env.VITE_CHAIN_ID as string;\nlet fallbackProviderOrUrl: string | Provider | undefined;\nlet finality = 12;\nlet blockTime = 15;\nlet nativeTokenSymbol = 'ETH';\nif (chainId !== '1') {\n  finality = 5; // TODO\n  blockTime = 10;\n  nativeTokenSymbol = 'ETH'; // TODO\n}\n\nif (chainId === '5') {\n  finality = 8; // TODO\n  blockTime = 15;\n  nativeTokenSymbol = 'ETH';\n}\n\nlet webWalletURL: string | undefined = import.meta.env.VITE_WEB_WALLET_ETH_NODE as string | undefined;\n\nlet localDev = false;\nif (chainId === '1337' || chainId === '31337') {\n  localDev = true;\n  fallbackProviderOrUrl = import.meta.env.VITE_ETH_NODE_URI_LOCALHOST as string;\n  webWalletURL = (import.meta.env.VITE_WEB_WALLET_ETH_NODE_LOCALHOST as string) || webWalletURL;\n\n  // const localEthNode = import.meta.env.VITE_ETH_NODE_URI_LOCALHOST as string;\n  // if (localEthNode && localEthNode !== '') {\n  //   fallbackProviderOrUrl = localEthNode;\n  // } else {\n  //   fallbackProviderOrUrl = 'http://localhost:8545';\n  // }\n  finality = 2;\n  blockTime = 5;\n}\n\nconst chainName = nameForChainId(chainId);\n\nif (!fallbackProviderOrUrl) {\n  const url = import.meta.env.VITE_ETH_NODE_URI as string; // TODO use query string to specify it // TODO settings\n  if (url && url !== '') {\n    fallbackProviderOrUrl = url;\n  }\n}\n\nif (fallbackProviderOrUrl && typeof fallbackProviderOrUrl === 'string') {\n  if (!fallbackProviderOrUrl.startsWith('http') && !fallbackProviderOrUrl.startsWith('ws')) {\n    // if no http nor ws protocol, assume fallbackProviderOrUrl is the network name\n    // use ethers fallback provider\n    fallbackProviderOrUrl = getDefaultProvider(fallbackProviderOrUrl, {\n      alchemy: import.meta.env.VITE_ALCHEMY_API_KEY || undefined,\n      etherscan: import.meta.env.VITE_ETHERSCAN_API_KEY || undefined,\n      infura: import.meta.env.VITE_INFURA_PROJECT_ID || undefined,\n      pocket: import.meta.env.VITE_POCKET_APP_ID || undefined,\n      quorum: 2,\n    });\n  } else {\n    fallbackProviderOrUrl = getDefaultProvider(fallbackProviderOrUrl); // still use fallback provider but use the url as is\n  }\n}\n\nconst graphNodeURL = import.meta.env.VITE_THE_GRAPH_HTTP as string;\n\nconst logPeriod = 7 * 24 * 60 * 60;\nconst deletionDelay = 7 * 24 * 60 * 60;\n\nconst lowFrequencyFetch = blockTime * 8;\nconst mediumFrequencyFetch = blockTime * 4;\nconst highFrequencyFetch = blockTime * 2;\n\nconst globalQueryParams = ['debug', 'log', 'subgraph', 'ethnode', '_d_eruda'];\n\nlet getName = () => {\n  return undefined;\n};\nfunction setGetName(func: () => string): void {\n  getName = func;\n}\n\nif (\n  import.meta.env.MODE === 'production' &&\n  import.meta.env.VITE_SENTRY_DSN &&\n  typeof import.meta.env.VITE_SENTRY_DSN === 'string'\n) {\n  Sentry.init({\n    release: __VERSION__,\n    dsn: import.meta.env.VITE_SENTRY_DSN as string,\n    beforeSend(event, hint) {\n      // Check if it is an exception, and if so, show the report dialog\n      // if (event.exception) {\n      //   console.error(`EXCEPTION`, event);\n      //   Sentry.showReportDialog({eventId: event.event_id, user: {name: getName(), email: 'noone@nowhere.eth'}});\n      // } else {\n      //   console.error(`sentry event`, event);\n      // }\n      return event;\n    },\n    integrations: [\n      new Integrations.BrowserTracing({\n        tracingOrigins: ['localhost', /^\\//], //, graphNodeURL.split('/')[0]], fails with \"has been blocked by CORS policy: Request header field sentry-trace is not allowed by Access-Control-Allow-Headers in preflight response.\"\n      }),\n      new RewriteFramesIntegration({\n        iteratee: (frame) => {\n          if (frame.filename) {\n            frame.filename = frame.filename.replace(root, '');\n          }\n          return frame;\n        },\n      }),\n    ],\n\n    // Set tracesSampleRate to 1.0 to capture 100%\n    // of transactions for performance monitoring.\n    // We recommend adjusting this value in production\n    tracesSampleRate: 1.0,\n  });\n  console.log('SENTRY ENABLED');\n  if (typeof window !== 'undefined') {\n    (window as any).generateError = (message) => {\n      const result = Sentry.captureMessage(message);\n      console.log({result});\n    };\n  }\n}\n\nexport {\n  finality,\n  fallbackProviderOrUrl,\n  webWalletURL,\n  chainId,\n  blockTime,\n  chainName,\n  nativeTokenSymbol,\n  graphNodeURL,\n  logPeriod,\n  lowFrequencyFetch,\n  mediumFrequencyFetch,\n  highFrequencyFetch,\n  globalQueryParams,\n  deletionDelay,\n  localDev,\n  setGetName,\n};\n\nif (typeof window !== 'undefined') {\n  (window as any).env = import.meta.env;\n}\n","import {writable} from 'svelte/store';\n\ntype Notification = {\n  id?: string;\n  delay: number;\n  onAcknowledge?: () => void;\n  title: string;\n  text: string;\n  type: 'error' | 'success' | 'info' | 'warning';\n};\n\ntype CurrentNotification = {\n  current?: Notification;\n};\n\nconst createStore = () => {\n  const recorded: Record<string, boolean> = {};\n  const pending: Notification[] = [];\n  const data: CurrentNotification = {\n    current: undefined,\n  };\n\n  let timeout: NodeJS.Timeout;\n\n  const {subscribe, set} = writable<CurrentNotification>(data);\n\n  function setCurrent(current: Notification | undefined) {\n    data.current = current;\n    set(data);\n    if (current && current.delay) {\n      if (current.onAcknowledge) {\n        current.onAcknowledge(); // TODO delay?\n      }\n      timeout = setTimeout(acknowledge, current.delay * 1000);\n    }\n  }\n\n  function acknowledge() {\n    const current = data.current;\n    if (current && !current.delay && current.onAcknowledge) {\n      current.onAcknowledge();\n    }\n    const next = pending.shift();\n    clearTimeout(timeout);\n    setCurrent(next);\n  }\n\n  function queue(notification: Notification) {\n    if (notification.id) {\n      if (recorded[notification.id]) {\n        return;\n      }\n      recorded[notification.id] = true;\n    }\n    if (pending.length > 0 || data.current) {\n      pending.push(notification);\n    } else {\n      setCurrent(notification);\n    }\n  }\n\n  return {\n    subscribe,\n    queue,\n    acknowledge,\n    clear: () => {\n      pending.splice(0, pending.length);\n      acknowledge();\n    },\n  };\n};\n\nexport const notifications = createStore();\n\n// USEFUL FOR DEBUGGING:\nif (typeof window !== 'undefined') {\n  /* eslint-disable @typescript-eslint/no-explicit-any */\n  (window as any).notifications = notifications;\n  /* eslint-enable @typescript-eslint/no-explicit-any */\n}\n"],"names":[],"mappings":"oDACiC,EAAkE,IAC7F,CAAC,QACI,CAAC,OAAQ,GAAI,SAAU,SAE1B,GAA8B,GAC9B,EAAO,EAAI,YAAY,QAEzB,GAAa,EACb,IAAS,OACE,EAAW,MAAM,EAAG,SAG7B,GAAW,EAAW,QAAQ,KAChC,IAAa,MAEZ,MAAM,EAAW,GACjB,MAAM,KACN,QAAQ,AAAC,GAAU,MACZ,CAAC,EAAK,EAAM,IAAM,EAAM,MAAM,OAChC,mBAAmB,IAAQ,IAAQ,GAAK,OAAS,mBAAmB,QAI1E,GAAW,EAAW,MAAM,EAAG,IAAa,SAC5C,IAAY,CAAC,EAAS,SAAS,UACrB,KAEP,CAAC,OAAQ,EAAK,wBAIsE,OACvF,OAAO,SAAW,YACb,CAAC,OAAQ,IAEX,EAAiB,OAAO,SAAS,iBAGA,EAAsC,IAC1E,MAAO,SAAW,kBACb,QAEH,GAAM,GAAO,OAAO,SAAS,KAC7B,EAA8B,GAC9B,EAAO,EAAI,YAAY,WAEzB,KAAS,MAER,MAAM,EAAO,GACb,MAAM,KACN,QAAQ,AAAC,GAAU,MACZ,CAAC,EAAK,EAAM,IAAM,EAAM,MAAM,OAChC,mBAAmB,IAAQ,mBAAmB,KAGjD,aAG6B,EAAuC,IACvE,GAAM,YACC,KAAO,QAAO,KAAK,GAAQ,MAC9B,GAAQ,EAAM,MACb,GAAG,IAAQ,GAAK,IAAM,MAAM,KAAO,UAErC,QCjEI,GAA0C,CACrD,IAAK,UACL,IAAK,UACL,IAAK,UACL,IAAK,SACL,KAAM,QACN,OAAQ,kBACR,QAAS,8BAGoB,EAAyB,MAChD,GAAO,EAAW,SACpB,IAGG,iBAAiB,ICH1B,QAAQ,IAAI,oCAEc,SACb,CAAC,UAAU,IAGlB,EAAU,QACZ,GACA,EAAW,GACX,EAAY,KAGH,IACC,MAYV,GAAW,QAgBT,GAAY,EAAe,GAyB3B,EAAe,yEASf,EAAoB,CAAC,QAAS,MAAO,WAAY,UAAW,YA0ElE,AAAI,MAAO,SAAW,aACnB,QAAe,IAAM,qQCnJxB,KAAM,GAAc,IAAM,MAClB,GAAoC,GACpC,EAA0B,GAC1B,EAA4B,CAChC,QAAS,WAGP,QAEE,CAAC,YAAW,OAAO,EAA8B,cAEnC,EAAmC,GAChD,QAAU,IACX,GACA,GAAW,EAAQ,OACjB,GAAQ,iBACF,kBAEA,WAAW,EAAa,EAAQ,MAAQ,kBAI/B,MACf,GAAU,EAAK,QACjB,GAAW,CAAC,EAAQ,OAAS,EAAQ,iBAC/B,qBAEJ,GAAO,EAAQ,qBACR,KACF,cAGE,EAA4B,IACrC,EAAa,GAAI,IACf,EAAS,EAAa,aAGjB,EAAa,IAAM,GAE1B,EAAQ,OAAS,GAAK,EAAK,UACrB,KAAK,KAEF,SAIR,CACL,YACA,QACA,cACA,MAAO,IAAM,GACH,OAAO,EAAG,EAAQ,eAMnB,EAAgB,IAG7B,AAAI,MAAO,SAAW,aAEnB,QAAe,cAAgB"}