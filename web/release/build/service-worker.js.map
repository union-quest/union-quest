{"version":3,"file":"service-worker.js","sources":["../../build/runtime/service-worker.js","../../../src/service-worker.ts"],"sourcesContent":["export const timestamp = 1652960917481;\n\nexport const build = [\n\t\"/_app/start-625938d6.js\",\n\t\"/_app/assets/start-f6bd5930.css\",\n\t\"/_app/pages/__layout.svelte-52f52818.js\",\n\t\"/_app/assets/pages/__layout.svelte-fa4af0df.css\",\n\t\"/_app/assets/CanvasBlockie.svelte_svelte_type_style_lang-10790f56.css\",\n\t\"/_app/error.svelte-cbd7a37b.js\",\n\t\"/_app/pages/index.svelte-f4168b8b.js\",\n\t\"/_app/pages/map.svelte-c5a09c13.js\",\n\t\"/_app/assets/pages/map.svelte-1e7ae53b.css\",\n\t\"/_app/chunks/vendor-ec6c92af.js\",\n\t\"/_app/chunks/paths-28a87002.js\",\n\t\"/_app/chunks/wallet-f19ba47f.js\",\n\t\"/_app/chunks/url-6a45ccd3.js\"\n];\n\nexport const files = [\n\t\"/images/Logo/Q Logo BIG.png\",\n\t\"/images/Logo/Q Logo.png\",\n\t\"/images/Logo/Q Logo.svg\",\n\t\"/images/Logo/Union Quest Long.svg\",\n\t\"/images/Logo/Union Quest.svg\",\n\t\"/images/Logo/Union.png\",\n\t\"/images/Logo/UnionQuest.png\",\n\t\"/images/Logo/UnionQuestTwitterBanner.png\",\n\t\"/images/Logo/unionTransp.png\",\n\t\"/images/Tiles/Feild 1.svg\",\n\t\"/images/Tiles/Feild 2.svg\",\n\t\"/images/Tiles/Feild 3.svg\",\n\t\"/images/Tiles/Village 2.svg\",\n\t\"/images/Tiles/Village 3.svg\",\n\t\"/images/Tiles/Village1.svg\",\n\t\"/images/Tiles/Windmill Winds.svg\",\n\t\"/images/Tiles/Windmill base.svg\",\n\t\"/images/eth-diamond-rainbow.png\",\n\t\"/images/loading.svg\",\n\t\"/images/logo.svg\",\n\t\"/images/logo_large.jpg.png\",\n\t\"/images/logo_large.png\",\n\t\"/images/metamask.svg\",\n\t\"/images/opera.svg\",\n\t\"/images/portis.svg\",\n\t\"/images/spinner.svg\",\n\t\"/images/status.svg\",\n\t\"/images/torus/apple.svg\",\n\t\"/images/torus/discord.svg\",\n\t\"/images/torus/facebook.svg\",\n\t\"/images/torus/github.svg\",\n\t\"/images/torus/google.svg\",\n\t\"/images/torus/jwt.svg\",\n\t\"/images/torus/line.svg\",\n\t\"/images/torus/linkedin.svg\",\n\t\"/images/torus/reddit.svg\",\n\t\"/images/torus/twitch.svg\",\n\t\"/images/torus/twitter.svg\",\n\t\"/images/walletconnect.svg\",\n\t\"/images/web3-default.png\",\n\t\"/maskable_icon_512x512.png\",\n\t\"/preview.png\",\n\t\"/pwa/android-chrome-144x144.png\",\n\t\"/pwa/android-chrome-192x192.png\",\n\t\"/pwa/android-chrome-256x256.png\",\n\t\"/pwa/android-chrome-36x36.png\",\n\t\"/pwa/android-chrome-384x384.png\",\n\t\"/pwa/android-chrome-48x48.png\",\n\t\"/pwa/android-chrome-512x512.png\",\n\t\"/pwa/android-chrome-72x72.png\",\n\t\"/pwa/android-chrome-96x96.png\",\n\t\"/pwa/apple-touch-icon-1024x1024.png\",\n\t\"/pwa/apple-touch-icon-114x114.png\",\n\t\"/pwa/apple-touch-icon-120x120.png\",\n\t\"/pwa/apple-touch-icon-144x144.png\",\n\t\"/pwa/apple-touch-icon-152x152.png\",\n\t\"/pwa/apple-touch-icon-167x167.png\",\n\t\"/pwa/apple-touch-icon-180x180.png\",\n\t\"/pwa/apple-touch-icon-57x57.png\",\n\t\"/pwa/apple-touch-icon-60x60.png\",\n\t\"/pwa/apple-touch-icon-72x72.png\",\n\t\"/pwa/apple-touch-icon-76x76.png\",\n\t\"/pwa/apple-touch-icon-precomposed.png\",\n\t\"/pwa/apple-touch-icon.png\",\n\t\"/pwa/apple-touch-startup-image-1125x2436.png\",\n\t\"/pwa/apple-touch-startup-image-1136x640.png\",\n\t\"/pwa/apple-touch-startup-image-1242x2208.png\",\n\t\"/pwa/apple-touch-startup-image-1242x2688.png\",\n\t\"/pwa/apple-touch-startup-image-1334x750.png\",\n\t\"/pwa/apple-touch-startup-image-1536x2048.png\",\n\t\"/pwa/apple-touch-startup-image-1620x2160.png\",\n\t\"/pwa/apple-touch-startup-image-1668x2224.png\",\n\t\"/pwa/apple-touch-startup-image-1668x2388.png\",\n\t\"/pwa/apple-touch-startup-image-1792x828.png\",\n\t\"/pwa/apple-touch-startup-image-2048x1536.png\",\n\t\"/pwa/apple-touch-startup-image-2048x2732.png\",\n\t\"/pwa/apple-touch-startup-image-2160x1620.png\",\n\t\"/pwa/apple-touch-startup-image-2208x1242.png\",\n\t\"/pwa/apple-touch-startup-image-2224x1668.png\",\n\t\"/pwa/apple-touch-startup-image-2388x1668.png\",\n\t\"/pwa/apple-touch-startup-image-2436x1125.png\",\n\t\"/pwa/apple-touch-startup-image-2688x1242.png\",\n\t\"/pwa/apple-touch-startup-image-2732x2048.png\",\n\t\"/pwa/apple-touch-startup-image-640x1136.png\",\n\t\"/pwa/apple-touch-startup-image-750x1334.png\",\n\t\"/pwa/apple-touch-startup-image-828x1792.png\",\n\t\"/pwa/browserconfig.xml\",\n\t\"/pwa/coast-228x228.png\",\n\t\"/pwa/favicon-16x16.png\",\n\t\"/pwa/favicon-32x32.png\",\n\t\"/pwa/favicon-48x48.png\",\n\t\"/pwa/favicon.ico\",\n\t\"/pwa/firefox_app_128x128.png\",\n\t\"/pwa/firefox_app_512x512.png\",\n\t\"/pwa/firefox_app_60x60.png\",\n\t\"/pwa/manifest.json\",\n\t\"/pwa/manifest.webapp\",\n\t\"/pwa/mstile-144x144.png\",\n\t\"/pwa/mstile-150x150.png\",\n\t\"/pwa/mstile-310x150.png\",\n\t\"/pwa/mstile-310x310.png\",\n\t\"/pwa/mstile-70x70.png\",\n\t\"/pwa/yandex-browser-50x50.png\",\n\t\"/pwa/yandex-browser-manifest.json\",\n\t\"/robots.txt\",\n\t\"/svgs/0.svg\",\n\t\"/svgs/1.svg\",\n\t\"/svgs/boat.svg\",\n\t\"/svgs/buoy.svg\",\n\t\"/svgs/shack.svg\",\n\t\"/svgs/shovel.svg\",\n\t\"/svgs/tree.svg\",\n\t\"/svgs/windmill.svg\"\n];","import {build, timestamp} from '$service-worker';\n\n///////////////////////////////////////////////////////////////////////////////\nconst URLS_TO_PRE_CACHE = build.concat(['_INJECT_PAGES_']);\nconst CACHE_NAME = 'cache-name' + timestamp;\nconst DEV = true;\n//////////////////////////////////////////////////////////////////////////////\n\nlet _logEnabled = true; // TODO false\nfunction log(...args) {\n  if (_logEnabled) {\n    console.debug(...args);\n  }\n}\n\nself.addEventListener('message', function (event) {\n  if (event.data && event.data.type === 'debug') {\n    _logEnabled = event.data.enabled && event.data.level >= 5;\n  } else if (event.data === 'skipWaiting') {\n    log(`skipWaiting received`);\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    (self as any).skipWaiting();\n  }\n});\n\nconst pathname = self.location.pathname;\nconst base = pathname.substr(0, pathname.length - 18); // assume service worker is named `service-worker.js` // name's length = 17\n\nconst urlsToPreCache = URLS_TO_PRE_CACHE.map((v) => base + v);\n\nconst regexesOnlineFirst = [];\nif (DEV) {\n  regexesOnlineFirst.push('localhost');\n}\n\nconst regexesOnlineOnly = [];\n\nconst regexesCacheFirst = [self.location.origin, 'https://rsms.me/inter/', 'cdn', '.*\\\\.png$', '.*\\\\.svg$'];\n\nconst regexesCacheOnly = [];\n\n// If the url doesn't match any of those regexes, it will do online first\n\nlog(`[Service Worker] Origin: ${self.location.origin}`);\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nself.addEventListener('install', (event: any) => {\n  log('[Service Worker] Install');\n  event.waitUntil(\n    caches\n      .open(CACHE_NAME)\n      .then((cache) => {\n        log(`[Service Worker] Creating cache: ${CACHE_NAME}`);\n        return cache.addAll(urlsToPreCache);\n      })\n      .then(() => {\n        // (self as any).skipWaiting();\n        log(`cache fully fetched!`);\n      })\n  );\n});\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nself.addEventListener('activate', (event: any) => {\n  log('[Service Worker] Activate');\n  event.waitUntil(\n    caches.keys().then((cacheNames) => {\n      return Promise.all(\n        cacheNames.map((thisCacheName) => {\n          if (thisCacheName !== CACHE_NAME) {\n            log(`[Service Worker] Deleting: ${thisCacheName}`);\n            return caches.delete(thisCacheName);\n          }\n        })\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      ).then(() => (self as any).clients.claim());\n    })\n  );\n});\n\nconst update = (request, cache) => {\n  return fetch(request)\n    .then((response) => {\n      return caches.open(CACHE_NAME).then((cache) => {\n        if (request.method === 'GET' && request.url.startsWith('http')) {\n          // only on http protocol to prevent chrome-extension request to error out\n          cache.put(request, response.clone());\n        }\n        return response;\n      });\n    })\n    .catch(() => {\n      return cache;\n    });\n};\n\nconst cacheFirst = {\n  method: (request, cache) => {\n    log(`[Service Worker] Cache first: ${request.url}`);\n    const fun = update(request, cache);\n    return cache || fun;\n  },\n  regexes: regexesCacheFirst,\n};\n\nconst cacheOnly = {\n  method: (request, cache) => {\n    log(`[Service Worker] Cache only: ${request.url}`);\n    return cache || update(request, cache);\n  },\n  regexes: regexesCacheOnly,\n};\n\nconst onlineFirst = {\n  method: (request, cache) => {\n    log(`[Service Worker] Online first: ${request.url}`);\n    return update(request, cache);\n  },\n  regexes: regexesOnlineFirst,\n};\n\nconst onlineOnly = {\n  method: (request) => {\n    log(`[Service Worker] Online only: ${request.url}`);\n    return fetch(request);\n  },\n  regexes: regexesOnlineOnly,\n};\n\nasync function getResponse(event: {request: Request}): Promise<Response> {\n  const request = event.request;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const registration = (self as any).registration as ServiceWorkerRegistration;\n  if (\n    event.request.mode === 'navigate' &&\n    event.request.method === 'GET' &&\n    registration.waiting &&\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    (await (self as any).clients.matchAll()).length < 2\n  ) {\n    log('only one client, skipWaiting as we navigate the page');\n    registration.waiting.postMessage('skipWaiting');\n    const response = new Response('', {headers: {Refresh: '0'}});\n    return response;\n  }\n\n  // TODO remove query param from matching, query param are used as config (why not use hashes then ?) const normalizedUrl = normalizeUrl(event.request.url);\n  const response = await caches.match(request).then((cache) => {\n    // The order matters !\n    const patterns = [onlineFirst, onlineOnly, cacheFirst, cacheOnly];\n\n    for (const pattern of patterns) {\n      for (const regex of pattern.regexes) {\n        if (RegExp(regex).test(request.url)) {\n          return pattern.method(request, cache);\n        }\n      }\n    }\n\n    return onlineFirst.method(request, cache);\n  });\n  return response;\n}\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nself.addEventListener('fetch', (event: any) => {\n  event.respondWith(getResponse(event));\n});\n"],"names":[],"mappings":"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"}